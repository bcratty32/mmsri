name: "CodeQL"

on:
  push:
    branches: [ "develop", "master" ]
  pull_request:
    branches: [ "develop" ]
  schedule:
    - cron: "4 23 * * 1"

jobs:
  analyze:
    name: Analyze
    runs-on: ubuntu-latest
    permissions:
      actions: read
      contents: read
      security-events: write

    strategy:
      fail-fast: false
      matrix:
        language: [ java ]

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Setup Java
        uses: actions/setup-java@v3
        with:
          distribution: temurin
          java-version: 17

      # - name: Setup Gradle
      #   uses: gradle/gradle-build-actions@v2
      #   with:
      #     config-file: ./github/gradle-build.yml
      - name: Setup Gradle
        uses: gradle/gradle-build-action@v2
    
      - name: Execute Gradle build
        run: ./gradlew build   
      # - name: Gradle Build Action
      #   # You may pin to the exact commit or the version.
      #   # uses: gradle/gradle-build-action@ef76a971e2fa3f867b617efd72f2fbd72cf6f8bc
      #   uses: gradle/gradle-build-action@v2.8.0
        # with:
        #   # Gradle version to use. If specified, this Gradle version will be downloaded, added to the PATH and used for invoking Gradle.
        #   # gradle-version: # optional
        #   # Path to the Gradle executable. If specified, this executable will be added to the PATH and used for invoking Gradle.
        #   gradle-executable: # optional
        #   # Path to the root directory of the build. Default is the root of the GitHub workspace.
        #   build-root-directory: # optional
        #   # When 'true', all caching is disabled. No entries will be written to or read from the cache.
        #   cache-disabled: # optional
        #   # When 'true', existing entries will be read from the cache but no entries will be written.
        #   # By default this value is 'false' for workflows on the GitHub default branch and 'true' for workflows on other branches.
      
        #   cache-read-only: # optional, default is ${{ github.event.repository != null && github.ref_name != github.event.repository.default_branch }}
        #   # When 'true', entries will not be restored from the cache but will be saved at the end of the Job. 
        #   # Setting this to 'true' implies cache-read-only will be 'false'.
      
        #   cache-write-only: # optional
        #   # When 'true', a pre-existing Gradle User Home will not prevent the cache from being restored.
        #   cache-overwrite-existing: # optional
        #   # Paths within Gradle User Home to cache.
        #   gradle-home-cache-includes: # optional, default is caches notifications
      
        #   # Paths within Gradle User Home to exclude from cache.
        #   gradle-home-cache-excludes: # optional
        #   # Gradle command line arguments (supports multi-line input)
        #   arguments: # optional
        #   # When 'false', no Job Summary will be generated for the Job.
        #   generate-job-summary: # optional, default is true
        #   # Specifies if a GitHub dependency snapshot should be generated for each Gradle build, and if so, how. Valid values are 'disabled' (default), 'generate', 'generate-and-submit' and 'download-and-submit'.
        #   dependency-graph: # optional, default is disabled
        #   # When 'true', the action will not attempt to restore the Gradle User Home entries from other Jobs.
        #   gradle-home-cache-strict-match: # optional
        #   # Used to uniquely identify the current job invocation. Defaults to the matrix values for this job; this should not be overridden by users (INTERNAL).
        #   workflow-job-context: # optional, default is ${{ toJSON(matrix) }}
        #   # When 'true', the action will attempt to remove any stale/unused entries from the Gradle User Home prior to saving to the GitHub Actions cache.
        #   gradle-home-cache-cleanup: # optional
        #   # The GitHub token used to authenticate when submitting via the Dependency Submission API.
        #   github-token: # optional, default is ${{ github.token }}

    
      - name: Initialize CodeQL
        uses: github/codeql-action/init@v2
        with:
          languages: ${{ matrix.language }}
          config-file: ./.github/codeql.yml
          queries: +security-and-quality

      - name: Autobuild
        run: echo "No Autobuild needed"
        # uses: github/codeql-action/autobuild@v2

      - name: Perform CodeQL Analysis
        uses: github/codeql-action/analyze@v2
        with:
          category: "/language:${{ matrix.language }}"
          
      - name: Upload SARIF results
        uses: github/codeql-action/upload-sarif@v1
        with:
          sarif_file: codeql-sarif.sarif


# name: "CodeQL"

# on:
#   push:
#     branches: [ "develop", "master" ]
#   pull_request:
#     branches: [ "develop" ]
#   schedule:
#     - cron: "4 23 * * 1"

# jobs:
#   analyze:
#     name: Analyze
#     runs-on: ubuntu-latest
#     permissions:
#       actions: write
#       contents: write
#       security-events: write

#     steps:
#       - name: Checkout
#         uses: actions/checkout@v3
#         with:
#           submodules: 'recursive'

#       - name: Setup Java
#         uses: actions/setup-java@v3
#         with:
#           distribution: temurin
#           java-version: 17

#       - name: Compile Java
#         run: ./gradlew --no-daemon bootRun

#       # Initialize for built-in queries
#       - name: Initialize CodeQL for built-in queries
#         uses: github/codeql-action/init@v2
#         with:
#           languages: ${{ matrix.language }}
#           config-file: ./.github/codeql.yml
#           queries: ./codeql-repo/java/ql/test/experimental/query-tests/security/CWE-502/
#           # queries: +security-and-quality,./.github/workflows/custom-queries/

#       - name: Autobuild
#         uses: github/codeql-action/autobuild@v2

#       # Analysis for built-in queries
#       - name: Perform CodeQL Analysis for built-in queries
#         uses: github/codeql-action/analyze@v2
#         with:
#           language: ${{ matrix.language }}
